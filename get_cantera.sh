#!/usr/bin/env bash

CANTERA="https://github.com/Cantera/cantera.git"

UNAMEOUT="$(uname -s)"
case "${UNAMEOUT}" in
    Linux*)
        MACHINE=Linux
        cxx_flags="-g -O3 -std=c++11"
        ;;
    Darwin*)
        MACHINE=Mac
        cxx_flags="-g -O3 -std=c++11"
        ;;
    CYGWIN*)
        MACHINE=Cygwin
        cxx_flags="-g -O3 -std=c++11 -U__STRICT_ANSI__"
        ;;
    MINGW*)
        MACHINE=MinGw
        cxx_flags="-g -O3 -std=c++11 -U__STRICT_ANSI__"
        ;;
    *)
        MACHINE="UNKNOWN:${UNAMEOUT}"
esac

export EXTERNAL="$(pwd)/external/${MACHINE}";

echo "# File generated by get_cantera.sh." > CanteraPFR/Makefile.in;
echo "EXTERNAL := ${EXTERNAL}" >> CanteraPFR/Makefile.in;
echo "EXTERNAL := ${EXTERNAL}" >> CanteraPFR/Makefile.in;

echo "Running from ${MACHINE}";
echo "Installing to ${EXTERNAL}";

git clone --recursive ${CANTERA};
cd cantera;

git checkout tags/v2.4.0;
git submodule update;

scons build \
    prefix=${EXTERNAL} \
    python_package="none" \
    system_eigen="n" \
    system_sundials="y" \
    f90_interface="n" \
    cxx_flags="${cxx_flags}";

# sundials_libdir
# blas_lapack_libs=""
# blas_lapack_dir=

scons test;
scons install;
